\chapter{Building Abstractions with Data}

\section{Introduction to Data Abstraction}

\subsection{Example: Arithmetic Operations for Rational Numbers}

\begin{exe}[2.1]
    A possibility for a \vscm{make-rat} handling both positive and negative 
    arguments:
    \scm{ch2/2.01.scm}
\end{exe}

\subsection{Abstraction Barriers}

\begin{exe}[2.2]
    Exemple implementation for the representation of segments in a plane:
    \scm{ch2/2.02.scm}
\end{exe}

\begin{exe}[2.3]
    In the following implementation, a rectangle is represented by its two 
    opposite sides, which must have the same orientation. The code makes use of 
    auxiliary procedures defined below.

    I added selectors to access each of the vertices of the rectangle to be 
    able to print rectangles in a uniform format.
    \scm{ch2/2.03.1.scm}

    The procedures that compute the perimeter and area of a rectangle, and the 
    procedure that prints a rectangle, are defined thus:
    \scm{ch2/2.03.perim-area.scm}

    Another possibility is to represent a rectangle by its four vertices:
    \scm{ch2/2.03.2.scm}

    Yet another possibility is to represent a rectangle by two perpendicular 
    segments with the same origin:
    \scm{ch2/2.03.3.scm}

    The procedures \vscm{perim-rect}, \vscm{area-rect} and \vscm{print-rect} 
    work in all three cases.

    \begin{comp}
        The code above makes use of the following auxiliary procedures to check 
        that the input is correct, compute the length of a segment, and print 
        points inline for use in \vscm{print-rect}:
        \scm{ch2/2.03.aux.scm}
    \end{comp}
\end{exe}

\subsection{What Is Meant by Data?}

\begin{exe}[2.4]
    With the representation of pairs given in the exercise, \vscm{(cons x y)} is 
    a procedure that takes as its argument a procedure \vscm{m} with two 
    arguments and returns the result of the application of \vscm{m} to \vscm{x} 
    and \vscm{y}.

    \vscm{(car z)} applies the procedure \vscm{(cons x y)} to the procedure that 
    returns the first of its arguments, so \vscm{(car (cons x y))} yields 
    \vscm{x}.

    Using the substitution model, the successive steps are:
    \scm{ch2/2.04a.scm}

    The corresponding definition of \vscm{cdr} is:
    \scm{ch2/2.04b.scm}
    The method to prove that \vscm{(cdr (cons x y))} yields \vscm{y} is the same 
    as with \vscm{car}.
\end{exe}

\begin{exe}[2.5]
    If $a$ and $b$ are known, we can compute $2^a 3^b$, and since the 
    decomposition of integers as a product of primes is unique, it’s possible to 
    find $a$ and $b$ from the value of $2^a 3^b$.

    The procedures \vscm{cons}, \vscm{car}, and \vscm{cdr} corresponding to this 
    representation can be defined as:
    \scm{ch2/2.05.scm}
\end{exe}

\begin{exe}[2.6]
    The successive substitution steps to evaluate \vscm{(add-1 zero)} are:
    \scm{ch2/2.06a.scm}

    In other words, \vscm{one} is a procedure that takes a one-argument 
    procedure as its argument and returns it.

    The substitution steps to evaluate \vscm{(add-1 one)} are:
    \scm{ch2/2.06b.scm}

    In other words, \vscm{two} is a procedure that takes a one-argument 
    procedure $f$ as its argument and returns the procedure $f \circ f$ ($f$ 
    applied twice).

    From these observations, and after remarking that \vscm{zero} is a procedure 
    that takes one argument and always returns the identity procedure, we can 
    make the hypothesis that the $n$th Church numeral is a procedure that takes 
    a one-argument procedure $f$ as its argument and returns the $n$th repeated 
    application of $f$ (see exercise~\ref{1.43}). This can be proved by 
    induction.

    \begin{proof}
        We’ve already shown that it’s true for $0$, $1$ and $2$.
        Let’s assume that it’s true for a positive integer $n$.

        From the induction hypothesis, \vscm{(n f)} is the $n$th repeated 
        application of $f$, so it’s obvious that
        \vscm{(lambda (x) (f ((n f) x)))} is the $(n + 1)$th repeatead 
        application of $f$, so the result is true for $n + 1$, hence it’s true 
        for any positive integer $n$.
    \end{proof}

    To apply a function $n + m$ times, we just need to apply it $m$ times, and 
    then $n$ times more, so \vscm{+} can be defined directly as:
    \scm{ch2/2.06c.scm}
\end{exe}

\subsection{Extended Exercise: Interval Arithmetic}

\begin{exe}[2.7]
    Since \vscm{make-interval} has been defined as \vscm{cons}, 
    \vscm{upper-bound} and \vscm{lower-bound} can be defined as \vscm{cdr} and 
    \vscm{car} respectively.
    \scm{ch2/2.07.scm}
\end{exe}

\begin{exe}[2.8]
    With the same reasoning as for division, the subtraction of two intervals is 
    the addition of the first with the opposite of the second.
    The subtraction procedure can thus be defined:
    \scm{ch2/2.08.scm}
\end{exe}
